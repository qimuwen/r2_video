<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R2 è§†é¢‘åº“</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="container">
            <h1>ğŸ¬ R2 è§†é¢‘åº“</h1>
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="æœç´¢è§†é¢‘...">
                <button onclick="searchVideos()">ğŸ” æœç´¢</button>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="filters">
            <button class="filter-btn active" data-filter="all">å…¨éƒ¨</button>
            <button class="filter-btn" data-filter="recent">æœ€è¿‘æ·»åŠ </button>
            <button class="filter-btn" data-filter="popular">çƒ­é—¨</button>
        </div>

        <div class="video-grid" id="videoGrid">
            <!-- è§†é¢‘å¡ç‰‡ä¼šé€šè¿‡ JavaScript åŠ¨æ€åŠ è½½ -->
        </div>

        <div class="loading" id="loading" style="display: none;">
            <div class="spinner"></div>
            <p>åŠ è½½ä¸­...</p>
        </div>

        <div class="empty-state" id="emptyState" style="display: none;">
            <p>ğŸ˜• æ²¡æœ‰æ‰¾åˆ°è§†é¢‘</p>
        </div>
    </main>

    <script>
        // é…ç½®
        const WORKER_URL = 'https://your-worker.workers.dev'; // æ›¿æ¢ä¸ºä½ çš„ Worker åŸŸå
        const SECRET_KEY = 'your-secret-key-change-this'; // æ›¿æ¢ä¸ºä½ çš„å¯†é’¥

        // ç¤ºä¾‹è§†é¢‘æ•°æ®ï¼ˆå®é™…åº”è¯¥ä» API è·å–ï¼‰
        const sampleVideos = [
            {
                id: 1,
                title: 'ç¤ºä¾‹è§†é¢‘ 1',
                path: 'video/sample1.mp4',
                thumbnail: 'https://via.placeholder.com/400x225/667eea/ffffff?text=Video+1',
                duration: '10:25',
                views: 1234,
                uploadDate: '2024-01-15'
            },
            {
                id: 2,
                title: 'ç¤ºä¾‹è§†é¢‘ 2',
                path: 'video/sample2.mp4',
                thumbnail: 'https://via.placeholder.com/400x225/764ba2/ffffff?text=Video+2',
                duration: '15:30',
                views: 5678,
                uploadDate: '2024-01-20'
            },
            {
                id: 3,
                title: 'ç¤ºä¾‹è§†é¢‘ 3',
                path: 'video/sample3.mp4',
                thumbnail: 'https://via.placeholder.com/400x225/f093fb/ffffff?text=Video+3',
                duration: '08:15',
                views: 9012,
                uploadDate: '2024-01-25'
            }
        ];

        // ç”Ÿæˆç­¾å URL
        async function generateSignedUrl(path, expiresIn = 86400) {
            const expires = Math.floor(Date.now() / 1000) + expiresIn;
            const data = `${path}:${expires}`;

            const encoder = new TextEncoder();
            const key = await crypto.subtle.importKey(
                'raw',
                encoder.encode(SECRET_KEY),
                { name: 'HMAC', hash: 'SHA-256' },
                false,
                ['sign']
            );

            const signature = await crypto.subtle.sign('HMAC', key, encoder.encode(data));
            const signatureHex = Array.from(new Uint8Array(signature))
                .map(b => b.toString(16).padStart(2, '0'))
                .join('');

            return `${WORKER_URL}/${path}?expires=${expires}&signature=${signatureHex}`;
        }

        // æ¸²æŸ“è§†é¢‘å¡ç‰‡
        function renderVideoCard(video) {
            return `
                <div class="video-card" data-id="${video.id}">
                    <div class="video-thumbnail">
                        <img src="${video.thumbnail}" alt="${video.title}">
                        <div class="video-duration">${video.duration}</div>
                        <div class="play-overlay">
                            <div class="play-btn">â–¶</div>
                        </div>
                    </div>
                    <div class="video-info">
                        <h3 class="video-title">${video.title}</h3>
                        <div class="video-meta">
                            <span>ğŸ‘ï¸ ${video.views.toLocaleString()} æ¬¡è§‚çœ‹</span>
                            <span>ğŸ“… ${video.uploadDate}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        // åŠ è½½è§†é¢‘åˆ—è¡¨
        async function loadVideos(filter = 'all') {
            const grid = document.getElementById('videoGrid');
            const loading = document.getElementById('loading');
            const emptyState = document.getElementById('emptyState');

            loading.style.display = 'flex';
            grid.innerHTML = '';
            emptyState.style.display = 'none';

            // æ¨¡æ‹Ÿ API å»¶è¿Ÿ
            await new Promise(resolve => setTimeout(resolve, 500));

            let videos = [...sampleVideos];

            // åº”ç”¨ç­›é€‰
            if (filter === 'recent') {
                videos.sort((a, b) => new Date(b.uploadDate) - new Date(a.uploadDate));
            } else if (filter === 'popular') {
                videos.sort((a, b) => b.views - a.views);
            }

            loading.style.display = 'none';

            if (videos.length === 0) {
                emptyState.style.display = 'flex';
            } else {
                grid.innerHTML = videos.map(renderVideoCard).join('');

                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                document.querySelectorAll('.video-card').forEach(card => {
                    card.addEventListener('click', async () => {
                        const videoId = card.dataset.id;
                        const video = videos.find(v => v.id == videoId);
                        await playVideo(video);
                    });
                });
            }
        }

        // æ’­æ”¾è§†é¢‘
        async function playVideo(video) {
            const signedUrl = await generateSignedUrl(video.path);
            window.location.href = `player.html?url=${encodeURIComponent(signedUrl)}&title=${encodeURIComponent(video.title)}`;
        }

        // æœç´¢è§†é¢‘
        function searchVideos() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const cards = document.querySelectorAll('.video-card');
            let hasResults = false;

            cards.forEach(card => {
                const title = card.querySelector('.video-title').textContent.toLowerCase();
                if (title.includes(query)) {
                    card.style.display = 'block';
                    hasResults = true;
                } else {
                    card.style.display = 'none';
                }
            });

            document.getElementById('emptyState').style.display = hasResults ? 'none' : 'flex';
        }

        // ç­›é€‰æŒ‰é’®äº‹ä»¶
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                loadVideos(btn.dataset.filter);
            });
        });

        // æœç´¢æ¡†å›è½¦äº‹ä»¶
        document.getElementById('searchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchVideos();
            }
        });

        // åˆå§‹åŠ è½½
        loadVideos();
    </script>
</body>
</html>

